import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

class Книга {
    private String название;
    private String автор;
    private String ISBN;
    private int количествоЭкземпляров;

    public Книга(String название, String автор, String ISBN, int количествоЭкземпляров) {
        this.название = название;
        this.автор = автор;
        this.ISBN = ISBN;
        this.количествоЭкземпляров = количествоЭкземпляров;
    }

    public String getНазвание() {
        return название;
    }

    public String getАвтор() {
        return автор;
    }

    public String getISBN() {
        return ISBN;
    }

    public int getКоличествоЭкземпляров() {
        return количествоЭкземпляров;
    }

    public void setКоличествоЭкземпляров(int количествоЭкземпляров) {
        this.количествоЭкземпляров = количествоЭкземпляров;
    }
}

class Читатель {
    private String имя;
    private int идентификатор;

    public Читатель(String имя, int идентификатор) {
        this.имя = имя;
        this.идентификатор = идентификатор;
    }

    public String getИмя() {
        return имя;
    }

    public int getИдентификатор() {
        return идентификатор;
    }
}

class Библиотека {
    private ArrayList<Книга> списокКниг = new ArrayList<>();
    private ArrayList<Читатель> списокЧитателей = new ArrayList<>();
    private Map<Читатель, ArrayList<Книга>> выданныеКниги = new HashMap<>();

    public void добавитьКнигу(Книга книга) {
        списокКниг.add(книга);
        System.out.println("Книга добавлена: " + книга.getНазвание());
    }

    public void удалитьКнигу(String ISBN) {
        списокКниг.removeIf(книга -> книга.getISBN().equals(ISBN));
        System.out.println("Книга с ISBN " + ISBN + " удалена.");
    }

    public void зарегистрироватьЧитателя(Читатель читатель) {
        списокЧитателей.add(читатель);
        System.out.println("Читатель зарегистрирован: " + читатель.getИмя());
    }

    public void удалитьЧитателя(int идентификатор) {
        списокЧитателей.removeIf(читатель -> читатель.getИдентификатор() == идентификатор);
        System.out.println("Читатель с идентификатором " + идентификатор + " удален.");
    }

    public void выдатьКнигу(String ISBN, int идентификатор) {
        Книга книга = найтиКнигу(ISBN);
        Читатель читатель = найтиЧитателя(идентификатор);

        if (книга != null && читатель != null && книга.getКоличествоЭкземпляров() > 0) {
            книга.setКоличествоЭкземпляров(книга.getКоличествоЭкземпляров() - 1);
            выданныеКниги.computeIfAbsent(читатель, k -> new ArrayList<>()).add(книга);
            System.out.println("Книга \"" + книга.getНазвание() + "\" выдана читателю " + читатель.getИмя());
        } else {
            System.out.println("Книга недоступна или читатель не найден.");
        }
    }

    public void вернутьКнигу(String ISBN, int идентификатор) {
        Книга книга = найтиКнигу(ISBN);
        Читатель читатель = найтиЧитателя(идентификатор);

        if (книга != null && читатель != null && выданныеКниги.containsKey(читатель)) {
            ArrayList<Книга> книгиЧитателя = выданныеКниги.get(читатель);
            if (книгиЧитателя.removeIf(к -> к.getISBN().equals(ISBN))) {
                книга.setКоличествоЭкземпляров(книга.getКоличествоЭкземпляров() + 1);
                System.out.println("Книга \"" + книга.getНазвание() + "\" возвращена читателем " + читатель.getИмя());
            } else {
                System.out.println("У читателя нет такой книги.");
            }
        } else {
            System.out.println("Ошибка возврата.");
        }
    }

    private Книга найтиКнигу(String ISBN) {
        return списокКниг.stream().filter(книга -> книга.getISBN().equals(ISBN)).findFirst().orElse(null);
    }

    private Читатель найтиЧитателя(int идентификатор) {
        return списокЧитателей.stream().filter(читатель -> читатель.getИдентификатор() == идентификатор).findFirst().orElse(null);
    }
}

public class БиблиотекаТест {
    public static void main(String[] args) {
        Библиотека библиотека = new Библиотека();

        Книга книга1 = new Книга("Война и мир", "Лев Толстой", "123456789", 3);
        Книга книга2 = new Книга("Преступление и наказание", "Федор Достоевский", "987654321", 2);

        библиотека.добавитьКнигу(книга1);
        библиотека.добавитьКнигу(книга2);

        Читатель читатель1 = new Читатель("Иван Иванов", 1);
        Читатель читатель2 = new Читатель("Анна Смирнова", 2);

        библиотека.зарегистрироватьЧитателя(читатель1);
        библиотека.зарегистрироватьЧитателя(читатель2);

        библиотека.выдатьКнигу("123456789", 1);
        библиотека.выдатьКнигу("987654321", 2);

        библиотека.вернутьКнигу("123456789", 1);

        библиотека.удалитьКнигу("987654321");

        библиотека.удалитьЧитателя(2);
    }
}